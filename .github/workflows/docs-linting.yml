name: Docs Linting

on: workflow_call

jobs:
  readme-linting:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Checkout latest rules
        uses: actions/checkout@v4
        with:
          repository: splunk-platform-apps/.github
          path: ./vale-rules
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Move files for Vale
        run: |
            cp vale-rules/.github/styles/.vale.ini .vale.ini
            mkdir -p .github/styles/
            cp -rf vale-rules/.github/styles/SplunkCommunity .github/styles
            ls -la
            ls -la .github/styles
      - name: Check whether root README exists
        run: |
          if [ ! -f README.md ]; then
            echo "README.md file is missing"
            exit 1
          fi
      - name: Check whether docs exists and contains a README
        run: |
          if [ -d "./docs" ]; then
            echo "Folder exists."
            if [ ! -f "./docs/readme.md" ]; then
              echo "docs/readme.md file is missing"
              exit 1
            fi
          else
            echo "Folder 'docs' does not exist."
            exit 1
          fi
      - name: Run Vale and Capture Output
        run: |
          # Download and install packages
          vale sync
          # Execute
          vale --output=JSON docs/*.md > vale-report.json || true

      - name: Upload Results
        uses: actions/upload-artifact@v4
        with:
          name: docs-linting-report
          path: vale-report.json
